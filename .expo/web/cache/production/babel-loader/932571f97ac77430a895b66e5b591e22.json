{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import{SyntheticPlatformEmitter,CodedError}from'@unimodules/core';import{VoiceQuality}from\"./Speech.types\";var MAX_SPEECH_INPUT_LENGTH=32767;export default{get name(){return'ExponentSpeech';},speak:function speak(id,text,options){var message,voices;return _regeneratorRuntime.async(function speak$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(text.length>MAX_SPEECH_INPUT_LENGTH)){_context.next=2;break;}throw new CodedError('ERR_SPEECH_INPUT_LENGTH','Speech input text is too long! Limit of input length is: '+MAX_SPEECH_INPUT_LENGTH);case 2:message=new SpeechSynthesisUtterance();if(typeof options.rate==='number'){message.rate=options.rate;}if(typeof options.pitch==='number'){message.pitch=options.pitch;}if(typeof options.language==='string'){message.lang=options.language;}if(typeof options.volume==='number'){message.volume=options.volume;}if('_voiceIndex'in options&&options._voiceIndex!=null){voices=window.speechSynthesis.getVoices();message.voice=voices[Math.min(voices.length-1,Math.max(0,options._voiceIndex))];}if(typeof options.onResume==='function'){message.onresume=options.onResume;}if(typeof options.onMark==='function'){message.onmark=options.onMark;}if(typeof options.onBoundary==='function'){message.onboundary=options.onBoundary;}message.onstart=function(nativeEvent){SyntheticPlatformEmitter.emit('Exponent.speakingStarted',{id:id,nativeEvent:nativeEvent});};message.onend=function(nativeEvent){SyntheticPlatformEmitter.emit('Exponent.speakingDone',{id:id,nativeEvent:nativeEvent});};message.onpause=function(nativeEvent){SyntheticPlatformEmitter.emit('Exponent.speakingStopped',{id:id,nativeEvent:nativeEvent});};message.onerror=function(nativeEvent){SyntheticPlatformEmitter.emit('Exponent.speakingError',{id:id,nativeEvent:nativeEvent});};message.text=text;window.speechSynthesis.speak(message);return _context.abrupt(\"return\",message);case 18:case\"end\":return _context.stop();}}},null,null,null,Promise);},getVoices:function getVoices(){var voices=window.speechSynthesis.getVoices();return voices.map(function(voice){return{identifier:voice.voiceURI,quality:VoiceQuality.Default,isDefault:voice.default,language:voice.lang,localService:voice.localService,name:voice.name,voiceURI:voice.voiceURI};});},isSpeaking:function isSpeaking(){return _regeneratorRuntime.async(function isSpeaking$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:return _context2.abrupt(\"return\",window.speechSynthesis.speaking);case 1:case\"end\":return _context2.stop();}}},null,null,null,Promise);},stop:function stop(){return _regeneratorRuntime.async(function stop$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:return _context3.abrupt(\"return\",window.speechSynthesis.cancel());case 1:case\"end\":return _context3.stop();}}},null,null,null,Promise);},pause:function pause(){return _regeneratorRuntime.async(function pause$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:return _context4.abrupt(\"return\",window.speechSynthesis.pause());case 1:case\"end\":return _context4.stop();}}},null,null,null,Promise);},resume:function resume(){return _regeneratorRuntime.async(function resume$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:return _context5.abrupt(\"return\",window.speechSynthesis.resume());case 1:case\"end\":return _context5.stop();}}},null,null,null,Promise);},maxSpeechInputLength:MAX_SPEECH_INPUT_LENGTH};","map":{"version":3,"sources":["../src/Speech/ExponentSpeech.web.ts"],"names":[],"mappings":"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","sourcesContent":["import { SyntheticPlatformEmitter, CodedError } from '@unimodules/core';\n\nimport { SpeechOptions, WebVoice, VoiceQuality } from './Speech.types';\n\n//https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesisUtterance/text\nconst MAX_SPEECH_INPUT_LENGTH = 32767;\n\nexport default {\n  get name(): string {\n    return 'ExponentSpeech';\n  },\n  async speak(id: string, text: string, options: SpeechOptions): Promise<SpeechSynthesisUtterance> {\n    if (text.length > MAX_SPEECH_INPUT_LENGTH) {\n      throw new CodedError(\n        'ERR_SPEECH_INPUT_LENGTH',\n        'Speech input text is too long! Limit of input length is: ' + MAX_SPEECH_INPUT_LENGTH\n      );\n    }\n\n    const message = new SpeechSynthesisUtterance();\n\n    if (typeof options.rate === 'number') {\n      message.rate = options.rate;\n    }\n    if (typeof options.pitch === 'number') {\n      message.pitch = options.pitch;\n    }\n    if (typeof options.language === 'string') {\n      message.lang = options.language;\n    }\n    if (typeof options.volume === 'number') {\n      message.volume = options.volume;\n    }\n    if ('_voiceIndex' in options && options._voiceIndex != null) {\n      const voices = window.speechSynthesis.getVoices();\n      message.voice = voices[Math.min(voices.length - 1, Math.max(0, options._voiceIndex))];\n    }\n    if (typeof options.onResume === 'function') {\n      message.onresume = options.onResume;\n    }\n    if (typeof options.onMark === 'function') {\n      message.onmark = options.onMark;\n    }\n    if (typeof options.onBoundary === 'function') {\n      message.onboundary = options.onBoundary;\n    }\n\n    message.onstart = (nativeEvent: SpeechSynthesisEvent) => {\n      SyntheticPlatformEmitter.emit('Exponent.speakingStarted', { id, nativeEvent });\n    };\n    message.onend = (nativeEvent: SpeechSynthesisEvent) => {\n      SyntheticPlatformEmitter.emit('Exponent.speakingDone', { id, nativeEvent });\n    };\n    message.onpause = (nativeEvent: SpeechSynthesisEvent) => {\n      SyntheticPlatformEmitter.emit('Exponent.speakingStopped', { id, nativeEvent });\n    };\n    message.onerror = (nativeEvent: SpeechSynthesisErrorEvent) => {\n      SyntheticPlatformEmitter.emit('Exponent.speakingError', { id, nativeEvent });\n    };\n\n    message.text = text;\n\n    window.speechSynthesis.speak(message);\n\n    return message;\n  },\n  getVoices(): WebVoice[] {\n    const voices = window.speechSynthesis.getVoices();\n    return voices.map(voice => ({\n      identifier: voice.voiceURI,\n      quality: VoiceQuality.Default,\n      isDefault: voice.default,\n      language: voice.lang,\n      localService: voice.localService,\n      name: voice.name,\n      voiceURI: voice.voiceURI,\n    }));\n  },\n  async isSpeaking(): Promise<boolean> {\n    return window.speechSynthesis.speaking;\n  },\n  async stop(): Promise<void> {\n    return window.speechSynthesis.cancel();\n  },\n  async pause(): Promise<void> {\n    return window.speechSynthesis.pause();\n  },\n  async resume(): Promise<void> {\n    return window.speechSynthesis.resume();\n  },\n  maxSpeechInputLength: MAX_SPEECH_INPUT_LENGTH,\n};\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}